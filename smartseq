tar -xzvf /smartseq/mm10_genome.tar.gz
tar -xzvf ./smartseq/mm10_genome.tar.gz -C ./smartseq/
hisat2 --dta -t -x ./smartseq/mm10/genome -1 ./SRR18472352_1.fastq.gz -2 ./SRR18472352_2.fastq.gz -S ./smartseq/hisat/CK4.sam 
#!/bin/bash

# 设置FASTQ文件目录和输出目录
FASTQ_DIR="./"
OUTPUT_DIR="./smartseq/hisat/"
HISAT_INDEX="./smartseq/mm10/genome"

# 遍历FASTQ文件目录中的每个单元格文件
for FASTQ_FILE in ${FASTQ_DIR}*_1.fastq.gz; do
    # 获取不含路径和文件后缀的文件名
    BASE_NAME=$(basename ${FASTQ_FILE} _1.fastq.gz)
    
    # 定义匹配的配对FASTQ文件名
    FASTQ1="${FASTQ_DIR}${BASE_NAME}_1.fastq.gz"
    FASTQ2="${FASTQ_DIR}${BASE_NAME}_2.fastq.gz"
    
    # 定义输出的SAM文件名
    OUTPUT_SAM="${OUTPUT_DIR}${BASE_NAME}.sam"

# 检查SAM文件是否已经存在
    if [ -f "${OUTPUT_SAM}" ]; then
        echo "SAM file ${OUTPUT_SAM} already exists, skipping..."
        continue
    fi
    
    # 运行HISAT2进行比对
    hisat2 -x ${HISAT_INDEX} -1 ${FASTQ1} -2 ${FASTQ2} -S ${OUTPUT_SAM} --dta -t
    
    echo "Processed ${BASE_NAME} and generated ${OUTPUT_SAM}"
done

echo "All files have been processed."



#!/bin/bash

# 设置SAM文件的输入目录和BAM文件的输出目录
SAM_DIR="./smartseq/hisat/"
BAM_DIR="./smartseq/bam/"

# 遍历输入目录中的每个SAM文件
for SAM_FILE in ${SAM_DIR}*.sam; do
    # 获取不含路径和文件后缀的文件名
    BASE_NAME=$(basename ${SAM_FILE} .sam)
    
    # 定义输出的BAM文件名和排序后的BAM文件名
    OUTPUT_BAM="${BAM_DIR}${BASE_NAME}.bam"
    SORTED_BAM_FILE="${BAM_DIR}${BASE_NAME}_sorted.bam"
    
    # 检查排序后的BAM文件是否已经存在
    if [ -f "${SORTED_BAM_FILE}" ]; then
        echo "Sorted BAM file ${SORTED_BAM_FILE} already exists, skipping..."
        continue
    fi
    
    # 转换SAM为BAM
    echo "Converting ${SAM_FILE} to ${OUTPUT_BAM}..."
    samtools view -S -b ${SAM_FILE} > ${OUTPUT_BAM}

    # 排序BAM文件
    echo "Sorting ${OUTPUT_BAM} to ${SORTED_BAM_FILE}..."
    samtools sort ${OUTPUT_BAM} -o ${SORTED_BAM_FILE}

    # 创建BAM文件索引
    echo "Indexing ${SORTED_BAM_FILE}..."
    samtools index ${SORTED_BAM_FILE}
    
    echo "Converted ${SAM_FILE} to BAM, sorted, and indexed."
done

echo "All SAM files have been converted to sorted and indexed BAM files."
